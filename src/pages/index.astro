---
// src/pages/index.astro
import BaseLayout from '@/layouts/BaseLayout.astro';
import type { HeadProps } from '@/types/HeadProps';

import { siteDefaults } from '@/config/siteDefaults';
import { siteImages } from '@/config/siteImages';
// import modifiedDates from '@/data/modified-dates.json';

import { lastModifiedRaw } from '@/utils/last-modified';
import { toMachineDate, toHumanDate, machineAndHuman } from '@/utils/date-format';

import CssFilesToLoad from "@/components/CssFilesToLoad.astro";

import Home from '@/content/pages/Home.astro';

// Prefer featured image, else fallback to site default (empty string is fine)
const heroImage = (siteImages as any)?.featuredImage ?? (siteImages as any)?.image ?? '';


// Last modified: try multiple keys; fall back to publishedDate
const rawLastMod = lastModifiedRaw(['index'], siteDefaults.publishedDate);

// For SEO/meta (machine readable) + UI (human readable)
const updatedAt   = toMachineDate(rawLastMod, 'now'); // e.g. "2025-09-12T01:23:45.000Z"
// const updatedAtHuman = toHumanDate(rawLastMod, 'now');   // e.g. "Sep 12, 2025" per site config

// const { iso: updatedAtISO, human: updatedAtHuman } = machineAndHuman(rawLastMod, 'now');

// Pull "index" entry from modified-dates or fall back to publishedDate
// const updatedAt =  modifiedDates['index'] ? new Date(modifiedDates['index']).toISOString(): siteDefaults.publishedDate;

// SEO head props for the homepage
const headProps: HeadProps = {
  title: siteDefaults.title,
  description: siteDefaults.description,
  image: heroImage,
  type: 'website', // homepage should be website (not article)
  url: `${siteDefaults.siteUrl}/`,
  canonicalUrl: `${siteDefaults.siteUrl}/`,
  siteName: siteDefaults.siteName,
  authors: [],
  publishedAt: siteDefaults.publishedDate,
  updatedAt,
  index: true,
  keywords: siteDefaults.keywords,
};
---

<BaseLayout headProps={headProps}>
  <Fragment slot="headContent-top">
 
     <CssFilesToLoad
        files={[
          { name: "home", preload: true, fetchPriority: "high" },
          { name: "home", inline: true}
        ]}
      />
  </Fragment>
  <Fragment slot="headContent-bottom" />
  <Home />
  <Fragment slot="extraScripts" />
</BaseLayout>
