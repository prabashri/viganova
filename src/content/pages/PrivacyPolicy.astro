---
// src/content/pages/PrivacyPolicy.astro
import HeroPages from '@/components/ui/HeroPages.astro';
import Anchor from '@/components/ui/Anchor.astro';
import { siteDefaults } from '@/config/siteDefaults';
import { siteFunctions } from '@/config/siteFunctions';
import { machineAndHuman } from '@/utils/date-format';

interface Props {
  updatedAt?: string | number | Date;
  publishedAt?: string | number | Date;
  title?: string;
  description?: string;
}

const props = Astro.props as Props;

/* ---------- helpers & safe fallbacks ---------- */
const eff = props.updatedAt
  ? machineAndHuman(props.updatedAt)
  : (props.publishedAt ? machineAndHuman(props.publishedAt) : undefined);

const websiteUrl = siteDefaults.siteUrl || `https://${siteDefaults.domainName}`;
const contactEmail = siteDefaults.contact?.email || siteDefaults.admin?.email || `contact@${siteDefaults.domainName}`;
const adminEmail   = siteDefaults.admin?.email || contactEmail;

// Terms link if configured
const termsPath =
  (siteDefaults as any)?.pages?.terms?.path || '/terms/';

// NEW: Cookie & Refund links if configured
const cookiePath =
  (siteDefaults as any)?.pages?.cookiePolicy?.path || '/cookie-policy/';
const refundPath =
  (siteDefaults as any)?.pages?.refund?.path || '/refund-policy/';

// Choose best address: site-level, then parentOrganization
const addr = siteDefaults.address || siteDefaults.parentOrganization?.address || null;

// Join non-empty parts with commas
const join = (...xs: Array<string | undefined>) => xs.filter(Boolean).join(', ');

// Build human-friendly location string (or '')
const location = addr
  ? join(
      addr.streetAddress,
      join(addr.addressLocality, addr.addressRegion),
      join(addr.postalCode, addr.addressCountry),
      addr.addressCountryCode
    )
  : '';

// Legal/display name of operating entity
const orgDisplayName =
  siteDefaults.parentOrganization?.legalName ||
  siteDefaults.legalName ||
  siteDefaults.parentOrganization?.name ||
  siteDefaults.siteName;

// Default page description
const pageDesc =
  props.description ??
  `${siteDefaults.siteName} explains how we collect, use, share, protect, and retain information while facilitating certificate & document attestation and apostille services in India (Notary → SDM → MEA) via authorised partners.`;
---

<article class="prose mx-auto" itemscope itemtype="https://schema.org/PrivacyPolicy">
  <HeroPages
    variant="post"
    title={`Privacy Policy of ${siteDefaults.siteName}`}
    description={pageDesc}
    meta={false}
    updatedAt={props.updatedAt || props.publishedAt}
    headingClass="my-05 mx-auto"
    class="mn-h-230 jc-center"
    descriptionClass="max-w-featured text-xl my-1"
  />

  <div class="max-w-content px-1 py-2 mx-auto">
    {eff?.human && (
      <p class="my-2">
        <strong>Effective date:</strong>
        {' '}
        <time datetime={eff.iso}>{eff.human}</time>
      </p>
    )}

    <p class="text-l mb-1">
      This Privacy Policy explains how <strong>{orgDisplayName}</strong> (“we”, “us”, or “our”)
      collects, uses, shares, protects, and retains information when you use our website and services to
      facilitate certificate and document attestation and apostille in India. We are committed to protecting
      your privacy and handling your data responsibly as stated in this policy.
    </p>

    <p>
      {siteDefaults.siteName} (<Anchor href={websiteUrl}>{websiteUrl}</Anchor>) provides facilitation for certificate
      and document attestation and apostille in India. We handle your documents safely and securely and coordinate
      with <strong>Notary</strong>, <strong>Sub-Divisional Magistrate (SDM)</strong>, and the
      {' '}<strong>Ministry of External Affairs (MEA)</strong> through authorised/representative partners where required.
      After processing, we arrange safe return delivery to your address.
    </p>

    <h2>1) Who we are</h2>
    <p>
      “We”, “us”, or “our” refers to <strong>{orgDisplayName}</strong>, operating the service branded as
      {' '}<strong>{siteDefaults.siteName}</strong>. We are an independent facilitation/assistance service and are
      <em> not</em> the Government or the MEA. Notary offices, SDM, MEA, and their outsourced providers are independent entities.
      {location && <> Our primary correspondence address is <strong>{location}</strong>.</>}
      {' '}For questions, contact us at <Anchor href={`mailto:${contactEmail}`}>{contactEmail}</Anchor>.
    </p>

    <h2>2) Scope of this policy</h2>
    <p>
      This policy covers information collected via our website, contact channels (email/phone/WhatsApp), pickup/delivery logistics,
      and while facilitating attestation/apostille workflows (Notary → SDM → MEA).
    </p>

    <h2>3) Information we collect</h2>
    <ul>
      <li><strong>Identity &amp; contact</strong>: name, phone, email, address, and communication preferences.</li>
      <li><strong>Document data</strong>: scans/copies of certificates (e.g., birth, marriage, degree, PCC), IDs, authorisations/POA, and details required by Notary/SDM/MEA.</li>
      <li><strong>Order &amp; logistics</strong>: service type, pickup/delivery details, tracking numbers.</li>
      <li><strong>Payments</strong>: handled by payment gateways; we store only necessary transaction references for billing/tax.</li>
      <li><strong>Device &amp; usage</strong>: IP, browser/OS, pages viewed, and cookies/analytics for performance and security.</li>
    </ul>

    <h2>4) How we collect it</h2>
    <ul>
      <li>Directly from you via website forms, email, phone, chat/WhatsApp, and pickup/delivery.</li>
      <li>From your authorised representative (if nominated).</li>
      <li>Automatically via cookies/analytics when you use our website.</li>
    </ul>

    <h2>5) Why we use it (lawful grounds)</h2>
    <ul>
      <li><strong>Service/contract</strong>: prepare submissions, coordinate Notary/SDM/MEA steps, update you, and return your documents.</li>
      <li><strong>Compliance</strong>: legal/record-keeping/KYC obligations as applicable.</li>
      <li><strong>Legitimate interests</strong>: secure our systems, prevent fraud/abuse, and improve quality.</li>
      <li><strong>Consent</strong>: where required (e.g., marketing, optional cookies). You may withdraw consent at any time.</li>
    </ul>

    <h2>6) Document scan handling (PDF/PNG/JPG; email/WhatsApp accepted)</h2>
    <p>
      We may collect <strong>scanned copies</strong> of your documents (PDF/PNG/JPG) to prepare filings when physical originals are not required.
      You may submit via secure upload (where available), <strong>email</strong>, or <strong>WhatsApp</strong>. Email and messaging apps are operated by
      third parties and may not offer end-to-end encryption by default. If you choose these channels, you accept their inherent risks.
    </p>
    <ul>
      <li>We <strong>print</strong> only what is necessary to complete the process and <strong>securely shred</strong> printed copies after use.</li>
      <li>We <strong>do not sell</strong>, publicly post, or disclose your documents; we <strong>do not</strong> use your documents to train AI models.</li>
      <li><strong>Retention</strong>: unless required by law, we delete document scans within <strong>30 days</strong> of order completion and
          securely dispose of printed copies within <strong>7–14 days</strong>. Invoices/tax records are retained as required by law.</li>
    </ul>

    <h2>7) Sharing &amp; disclosures</h2>
    <p>We do <strong>not</strong> sell your data. We share only what is necessary to deliver the service:</p>
    <ul>
      <li><strong>Notaries &amp; SDM offices</strong> (notarisation/attestation).</li>
      <li><strong>MEA &amp; its authorised/outsourced service providers</strong> (apostille/attestation processing).</li>
      <li><strong>Courier/logistics partners</strong> (secure pickup/return with tracking).</li>
      <li><strong>Payment gateways</strong> (payment processing; we don’t store full card data).</li>
      <li><strong>Hosting/CDN, security, email</strong> (site operations), and <strong>analytics</strong>{siteFunctions?.analyticsId && <> (e.g., GA ID: {siteFunctions.analyticsId})</>}.</li>
      <li><strong>When required by law</strong> or to protect rights, users, or the public.</li>
    </ul>
    <p class="col-base-70">
      Note: Government bodies and their vendors apply their <em>own</em> policies. We cannot control internal handling within Notary, SDM, or MEA offices.
    </p>

    <h2>8) Security</h2>
    <ul>
      <li>HTTPS, access controls (least-privilege), device security, secure printers, and disposal procedures.</li>
      <li>Operational logs and limited audit trails; partner diligence and minimum necessary disclosures.</li>
    </ul>

    <h2>9) International processing</h2>
    <p>
      Hosting/email/analytics or other vendors may process data outside India. We use reputable providers and apply appropriate safeguards consistent with applicable laws.
    </p>

    <h2>10) Your choices &amp; rights</h2>
    <ul>
      <li>Request <strong>access, correction, or deletion</strong> of your personal data.</li>
      <li><strong>Withdraw consent</strong> (for optional processing) at any time.</li>
      <li><strong>Opt out</strong> of non-essential cookies via your browser or available controls.</li>
      <li>We aim to respond within <strong>15 business days</strong>.</li>
    </ul>

    <h2>11) Cookies &amp; analytics</h2>
    <p>
      We may use cookies for functionality, performance, and analytics. Manage preferences in your browser or cookie controls.
      For details on categories, partners, and how to clear cookies in major browsers, see our
      {' '}<Anchor href={cookiePath}><strong>Cookie Policy</strong></Anchor>.
    </p>


    <h2>12) Communications</h2>
    <p>
      We use email/phone/WhatsApp strictly to deliver your service (updates, queries, delivery coordination).
      Marketing messages are sent only with consent and include opt-out options.
    </p>

    <h2>13) Minors’ data</h2>
    <p>
      If you submit documents for a <strong>minor</strong>, you confirm you are the parent/guardian or otherwise lawfully authorised to provide such data for the requested purpose.
    </p>

    <h2>14) Breach response</h2>
    <p>
      In the unlikely event of a security incident affecting personal data, we will investigate, mitigate, and notify affected users and/or authorities as required by applicable law.
    </p>

    <h2>15) Changes to this policy</h2>
    <p>
      We may update this Policy. The <strong>Effective date</strong> above reflects the latest version. Continued use of our website/services means you accept the updated policy.
    </p>

    <h2>16) Contact &amp; grievance</h2>
    <p>For privacy questions, requests, or grievances, contact:</p>
    <p class="my-05">
      📧 <Anchor href={`mailto:${contactEmail}`}><strong>{contactEmail}</strong></Anchor>
    </p>
    {adminEmail && adminEmail !== contactEmail && (
      <p class="my-05">Admin: <Anchor href={`mailto:${adminEmail}`}><strong>{adminEmail}</strong></Anchor></p>
    )}
    {siteDefaults?.contact?.phone && <p class="my-05">📞 {siteDefaults.contact.phone}</p>}
    {location && <p class="my-05">📍 {location}</p>}

    <hr class="my-2" />

    <p class="text-s col-base-70">
      Looking for our service terms? Read our <Anchor href={termsPath}><strong>Terms &amp; Conditions</strong></Anchor>.
      <br />
      Learn more about cookies in our <Anchor href={cookiePath}><strong>Cookie Policy</strong></Anchor>.
      <br />
      See payment reversals and cancellations in our <Anchor href={refundPath}><strong>Refund Policy</strong></Anchor>.
    </p>
  </div>
</article>
