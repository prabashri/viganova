---
import HeroPages from '@/components/ui/HeroPages.astro';
import Anchor from '@/components/ui/Anchor.astro';
import { siteDefaults } from '@/config/siteDefaults';
import { siteFunctions } from '@/config/siteFunctions';
import { machineAndHuman } from '@/utils/date-format';

interface Props {
  updatedAt?: string | number | Date;
  publishedAt?: string | number | Date;
  title?: string;
  description?: string;
}

const props = Astro.props as Props;

/* ---------- helpers & safe fallbacks ---------- */
const eff = props.updatedAt
  ? machineAndHuman(props.updatedAt)
  : (props.publishedAt ? machineAndHuman(props.publishedAt) : undefined);

const websiteUrl = siteDefaults.siteUrl || `https://${siteDefaults.domainName}`;
const contactEmail = siteDefaults.contact?.email || siteDefaults.admin?.email || `contact@${siteDefaults.domainName}`;
const adminEmail   = siteDefaults.admin?.email || contactEmail;

// Terms link if configured
const termsPath =
  (siteDefaults as any)?.pages?.terms?.path || '/terms/';

// Cookie / Refund / etc. (may not exist yet in energy context, leaving fallback routes)
const cookiePath =
  (siteDefaults as any)?.pages?.cookiePolicy?.path || '/cookie-policy/';
const refundPath =
  (siteDefaults as any)?.pages?.refund?.path || '/refund-policy/';

// Choose best address: site-level, then parentOrganization
const addr = siteDefaults.address || (siteDefaults as any).parentOrganization?.address || null;

// Join non-empty parts with commas
const join = (...xs: Array<string | undefined>) => xs.filter(Boolean).join(', ');

// Build human-friendly location string (or '')
const location = addr
  ? join(
      addr.streetAddress,
      join(addr.addressLocality, addr.addressRegion),
      join(addr.postalCode, addr.addressCountry),
      addr.addressCountryCode
    )
  : '';

// Legal/display name of operating entity
const orgDisplayName =
  (siteDefaults as any).parentOrganization?.legalName ||
  siteDefaults.legalName ||
  (siteDefaults as any).parentOrganization?.name ||
  siteDefaults.siteName;

// Default page description (rewritten for Viga Nova / green energy)
const pageDesc =
  props.description ??
  `${siteDefaults.siteName} explains how we collect, use, protect, and retain personal and business information shared with us (for example, when you contact us about hydrogen technology, electrolyzers, storage systems, or research collaboration).`;
---

<article class="prose mx-auto" itemscope itemtype="https://schema.org/PrivacyPolicy">
  <HeroPages
    variant="post"
    title={`Privacy Policy of ${siteDefaults.siteName}`}
    description={pageDesc}
    meta={false}
    updatedAt={props.updatedAt || props.publishedAt}
    headingClass="my-05 mx-auto"
    class="mn-h-230 jc-center"
    descriptionClass="max-w-featured text-xl my-1"
  />

  <div class="max-w-content px-1 py-2 mx-auto">
    {eff?.human && (
      <p class="my-2">
        <strong>Effective date:</strong>{' '}
        <time datetime={eff.iso}>{eff.human}</time>
      </p>
    )}

    <p class="text-l mb-1">
      This Privacy Policy explains how <strong>{orgDisplayName}</strong> (“we”, “us”, or “our”)
      collects, uses, shares, protects, and retains information when you visit our website,
      contact us, or engage with us about hydrogen energy systems, electrolyzers, energy
      storage, Power-to-Gas solutions, or research and development initiatives.
    </p>

    <p>
      {siteDefaults.siteName} (<Anchor href={websiteUrl}>{websiteUrl}</Anchor>) is focused on
      next-generation clean energy technologies. We work with research institutions, industry,
      government, and strategic partners to advance hydrogen production, storage, and energy
      infrastructure. In doing so, we may receive certain personal, business, or technical
      information from you. This policy describes how we handle that information.
    </p>

    <h2>1) Who we are</h2>
    <p>
      “We”, “us”, or “our” refers to <strong>{orgDisplayName}</strong>, operating under the brand
      <strong> {siteDefaults.siteName}</strong>. We are an independent clean energy / hydrogen
      technology company. We are <em>not</em> a government office or regulatory body.
      {location && <> Our primary correspondence address is <strong>{location}</strong>.</>}
      {' '}For questions about this Privacy Policy, contact us at{' '}
      <Anchor href={`mailto:${contactEmail}`}>{contactEmail}</Anchor>.
    </p>

    <h2>2) Scope of this policy</h2>
    <p>
      This policy applies to information we collect:
    </p>
    <ul>
      <li>when you visit our website or landing pages,</li>
      <li>when you contact us by email, phone, or messaging apps,</li>
      <li>when you request product or partnership information, pricing, or technical specifications,</li>
      <li>when you discuss pilot programs, research collaboration, investment, or commercial deployment with us,</li>
      <li>when you sign up for updates, briefings, newsletters, or events hosted by us.</li>
    </ul>
    <p>
      This policy does <strong>not</strong> cover systems, websites, or platforms operated by
      third parties, including universities, laboratories, payment processors, logistics
      providers, or government agencies. Those entities apply their own privacy policies.
    </p>

    <h2>3) Information we collect</h2>
    <ul>
      <li>
        <strong>Contact information:</strong> name, email address, phone number, company / institution,
        role/title, region.
      </li>
      <li>
        <strong>Business / technical inquiries:</strong> details you voluntarily share about your project,
        including hydrogen production needs, electrolyzer capacity requirements, storage/transport
        considerations, P2G interest, site constraints, or timeline.
      </li>
      <li>
        <strong>Communications:</strong> messages you send us (for example, R&amp;D partnership requests,
        pilot site discussions, integration questions).
      </li>
      <li>
        <strong>Operational logistics:</strong> if we start working together, we may request site/location
        details, utility specs, safety/regulatory constraints, or installation requirements.
      </li>
      <li>
        <strong>Website / device data:</strong> IP address, browser/OS type, pages visited, referring URL,
        timestamps, and basic analytics/cookie data that help us secure and improve the site.
      </li>
      <li>
        <strong>Payment or commercial records:</strong> if we enter into a commercial relationship,
        we may collect invoicing details, purchase orders, and billing-related information.
        We do <em>not</em> store full payment card numbers ourselves.
      </li>
    </ul>

    <h2>4) How we collect this information</h2>
    <ul>
      <li><strong>Directly from you:</strong> when you email us, call us, submit a form, or request technical material.</li>
      <li><strong>From your organization:</strong> when a colleague or partner lists you as a point of contact.</li>
      <li><strong>Automatically:</strong> via cookies, analytics scripts, and server logs when you browse our site.</li>
    </ul>

    <h2>5) How we use your information (lawful bases)</h2>
    <ul>
      <li>
        <strong>To respond to you:</strong> answer technical questions, send requested documentation,
        arrange calls, discuss pilots or deployment opportunities.
      </li>
      <li>
        <strong>To explore partnerships:</strong> research collaboration, manufacturing, integration,
        funding, or demonstration projects.
      </li>
      <li>
        <strong>To improve our technology and services:</strong> understand what performance,
        safety, cost, or regulatory requirements matter most to industry and public-sector users.
      </li>
      <li>
        <strong>To maintain security and reliability:</strong> protect our infrastructure,
        detect abuse, prevent fraud, and comply with applicable law.
      </li>
      <li>
        <strong>With your consent:</strong> if you opt in to receive updates, newsletters,
        product announcements, or event invites.
      </li>
    </ul>

    <h2>6) Research &amp; technical collaboration</h2>
    <p>
      We sometimes work with universities, labs, and industrial partners to evaluate new
      hydrogen production methods, electrolyzer stack performance, catalyst lifetime,
      storage systems, or Power-to-Gas integration.
    </p>
    <ul>
      <li>
        We may share <strong>non-public technical information</strong> that you provide with
        specific partners <strong>only</strong> if it is necessary for evaluating feasibility
        or collaboration — and typically under NDA or similar confidentiality controls.
      </li>
      <li>
        We do <strong>not</strong> sell your information.
      </li>
      <li>
        We do <strong>not</strong> publish proprietary details you send us as marketing material
        without explicit permission.
      </li>
      <li>
        We do <strong>not</strong> use your private project data to train general-purpose AI models.
      </li>
    </ul>

    <h2>7) Sharing &amp; disclosures</h2>
    <p>
      We do <strong>not</strong> sell your personal data. We may share limited information with:
    </p>
    <ul>
      <li>
        <strong>Vendors / service providers</strong> who help us operate our website, email,
        analytics, communications, hosting, storage, or security systems.
        {siteFunctions?.analyticsId && <> (Analytics ID: {siteFunctions.analyticsId})</>}
      </li>
      <li>
        <strong>Advisors, integrators, or engineering partners</strong> who help evaluate a
        deployment or pilot that you specifically asked us about.
      </li>
      <li>
        <strong>Payment / billing providers</strong> to process commercial transactions,
        invoices, or POs.
      </li>
      <li>
        <strong>Regulatory or safety bodies</strong> only if legally required or relevant to
        compliance/safety certification.
      </li>
      <li>
        <strong>Law enforcement / legal requests</strong> if required by applicable law, or
        to protect rights, safety, or security.
      </li>
    </ul>

    <h2>8) Security</h2>
    <ul>
      <li>We use HTTPS, access controls, and commercially reasonable security practices.</li>
      <li>We restrict internal access to sensitive project information to personnel who need it.</li>
      <li>We encourage using official company email channels for sharing sensitive specs rather than unsecured social messaging apps.</li>
    </ul>

    <h2>9) International transfers</h2>
    <p>
      We may store or process information in multiple countries/regions (for example, India,
      South Korea, the EU, or the US) depending on our hosting, academic collaborations,
      or vendor infrastructure. By engaging with us, you understand your information may
      be transferred across borders.
    </p>

    <h2>10) Data retention</h2>
    <p>
      We retain business contact info and project inquiry details for as long as needed to
      communicate with you, plan or execute collaboration, comply with legal requirements,
      and maintain reasonable business records. If you become a commercial partner or pilot
      site, we may retain relevant technical and contractual records for audit/compliance
      and safety traceability.
    </p>
    <p class="text-s opacity-80">
      If you would like us to delete certain contact or inquiry data, you can request that
      (see “Your rights” below) and we will comply where legally and operationally possible.
    </p>

    <h2>11) Cookies &amp; analytics</h2>
    <p>
      We may use cookies and similar technologies for essential site functionality,
      security, performance analytics, and to understand interest in our technology.
      You can usually disable non-essential cookies through your browser.
    </p>
    <p class="text-s opacity-80">
      For details on how cookies work and how to manage them, see our
      {' '}
      <Anchor href={cookiePath}><strong>Cookie Policy</strong></Anchor>.
    </p>

    <h2>12) Your rights &amp; choices</h2>
    <ul>
      <li>
        You may <strong>request access, correction, or deletion</strong> of personal information we hold about you.
      </li>
      <li>
        You may <strong>withdraw consent</strong> to optional communications (for example, newsletters or marketing updates).
      </li>
      <li>
        You may <strong>object</strong> to certain processing where permitted by law.
      </li>
      <li>
        We aim to respond within <strong>15 business days</strong>.
      </li>
    </ul>

    <h2>13) Communications and updates</h2>
    <p>
      We use your contact details to respond to your inquiries, coordinate technical
      discussions, and (if you opt in) send relevant updates about our hydrogen systems,
      storage solutions, or pilot programs. You can opt out of non-essential updates at
      any time by replying or contacting us.
    </p>

    <h2>14) Children / minors</h2>
    <p>
      Our website and services are intended for professionals, researchers, partners,
      regulators, and businesses in the clean energy sector. We do not knowingly collect
      personal information from children.
    </p>

    <h2>15) Changes to this Policy</h2>
    <p>
      We may update this Privacy Policy as our technology, partnerships, or legal
      obligations evolve. The <strong>Effective date</strong> above reflects the most
      recent version. Continued use of our website or continued engagement with us
      after changes means you accept the updated Policy.
    </p>

    <h2>16) Contact &amp; privacy questions</h2>
    <p>For privacy questions, requests, or grievances, contact:</p>

    <p class="my-05">
      📧 <Anchor href={`mailto:${contactEmail}`}><strong>{contactEmail}</strong></Anchor>
    </p>

    {adminEmail && adminEmail !== contactEmail && (
      <p class="my-05">
        Admin:{' '}
        <Anchor href={`mailto:${adminEmail}`}>
          <strong>{adminEmail}</strong>
        </Anchor>
      </p>
    )}

    {siteDefaults?.contact?.phone && (
      <p class="my-05">📞 {siteDefaults.contact.phone}</p>
    )}

    {location && (
      <p class="my-05">📍 {location}</p>
    )}

    <hr class="my-2" />

    <p class="text-s col-base-70">
      See also our{' '}
      <Anchor href={termsPath}><strong>Terms &amp; Conditions</strong></Anchor>.
      <br />
      Learn how cookies are used in our{' '}
      <Anchor href={cookiePath}><strong>Cookie Policy</strong></Anchor>.
      {/*
        Refund/Return policy may or may not be relevant to industrial systems.
        Keeping it referenced, but you can safely hide this line if you don't do
        consumer checkout / e-commerce.
      */}
      <br />
      Billing / commercial commitments are governed separately; see{' '}
      <Anchor href={refundPath}><strong>Refund Policy</strong></Anchor> if applicable.
    </p>
  </div>
</article>
